<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel</title>
    <style>
        body{
            font-family: Arial, sans-serif;
        }
        table{
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }
        th, td{
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th{
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>

    <h1>Student Admin Panel</h1>

    <table id="studentTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>City</th>
                <th>Username</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- Data yahan JS se aayega -->
        </tbody>
    </table>
      <script>
        let currentEditingRow = null;
window.onload = function(){
    loadStudents();
};

function loadStudents(){
    fetch("http://localhost:1000/students")
    .then(res => res.json())
    .then(data => {

        console.log("API DATA:", data); // üî• debug line

        if(!data.students){
            console.log("No students key in response");
            return;
        }

        let students = data.students;
        let tbody = document.getElementById("tableBody");
        tbody.innerHTML = "";

            students.forEach(stu => {
            let row = `
            <tr data-id="${stu.id}">
                <td>${stu.name}</td>
                <td>${stu.email}</td>
                <td>${stu.city}</td>
                <td>${stu.username}</td>
            <td>
                <button onclick="editRow(this)">‚úèÔ∏è</button>
                <button onclick="deleteStudent(${stu.id})">üóëÔ∏è</button>
            </td>
        </tr>
        `;
  
            tbody.innerHTML += row;
        });
    })
    .catch(err => {
        console.log("Fetch Error:", err);
    });
}
// ===== DELETE =====
function deleteStudent(id){
    if(!confirm("Are you sure you want to delete this student?")){
        return;
    }

    fetch(`http://localhost:1000/student/${id}`, {
        method: "DELETE"
    })
    .then(res => res.json())
    .then(data => {
        alert(data.message);
        loadStudents(); // reload table
    })
    .catch(err => console.log(err));
}
// ===== EDIT =====
function editRow(button){

    let row = button.closest("tr");

    // Agar koi aur row edit me hai, use reset karo
    if(currentEditingRow && currentEditingRow !== row){
        resetRow(currentEditingRow);
    }

    currentEditingRow = row;

    let nameCell = row.children[0];
    let emailCell = row.children[1];
    let cityCell = row.children[2];
    let usernameCell = row.children[3];

    nameCell.innerHTML = `<input type="text" value="${nameCell.innerText}">`;
    emailCell.innerHTML = `<input type="text" value="${emailCell.innerText}">`;
    cityCell.innerHTML = `<input type="text" value="${cityCell.innerText}">`;
    usernameCell.innerHTML = `<input type="text" value="${usernameCell.innerText}">`;

    button.innerText = "üíæ";
    button.onclick = function(){
        saveRow(this);
    };
}

// ===== SAVE =====
function saveRow(button){

    let row = button.closest("tr");
    let id = row.getAttribute("data-id");

    let name = row.children[0].querySelector("input").value;
    let email = row.children[1].querySelector("input").value;
    let city = row.children[2].querySelector("input").value;
    let username = row.children[3].querySelector("input").value;

    fetch(`http://localhost:1000/student/${id}`, {
        method: "PUT",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            name,
            email,
            city,
            username
        })
    })
    .then(res => res.json())
    .then(data => {

        row.children[0].innerText = name;
        row.children[1].innerText = email;
        row.children[2].innerText = city;
        row.children[3].innerText = username;

        button.innerText = "‚úèÔ∏è";
        button.onclick = function(){
            editRow(this);
        };

        currentEditingRow = null;
    })
    .catch(err => console.log(err));
}

// ===== RESET ROW =====
function resetRow(row){

    let name = row.children[0].querySelector("input").value;
    let email = row.children[1].querySelector("input").value;
    let city = row.children[2].querySelector("input").value;
    let username = row.children[3].querySelector("input").value;

    row.children[0].innerText = name;
    row.children[1].innerText = email;
    row.children[2].innerText = city;
    row.children[3].innerText = username;

    let button = row.querySelector("button");
    button.innerText = "‚úèÔ∏è";
    button.onclick = function(){
        editRow(this);
    };

    currentEditingRow = null;
}
</script>       
</body>
</html>
