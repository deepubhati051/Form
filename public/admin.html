<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
    body{
        font-family: 'Segoe UI', sans-serif;
        background: linear-gradient(135deg, #dbeafe, #e0f2fe, #f0f9ff);
        margin: 0;
        padding: 25px;
    }

    h1{
        color: black;
        text-align: center;
        margin-bottom: 25px;
        font-weight: 500;
    }

    table{
        width: 75%;
        margin: auto;
        border-collapse: collapse;
        background: #f4f6fb;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }

    thead{
        background: #1e3a8a;
        color: white;
    }

    th, td{
        padding: 10px 14px;   /* ðŸ”¥ reduced spacing */
        text-align: left;
        font-size: 14px;
    }

    th{
        font-weight: 500;
        letter-spacing: 0.3px;
    }

    tbody tr{
        border-bottom: 1px solid #d1d5db;
        transition: background 0.2s ease;
    }

    tbody tr:hover{
        background-color: #f4f6ff;
    }

    tbody tr:last-child{
        border-bottom: 2px solid #cbd5e1;
    }

    /* ===== SIMPLE BUTTON STYLE ===== */

    button{
        background: none;
        border: none;
        cursor: pointer;
        font-size: 16px;
        margin-right: 10px;
        color: #111;
        transition: 0.2s ease;
}

    button:hover{
        color: #2563eb;
        transform: scale(1.2);
}


    input{
        padding: 4px;
        font-size: 13px;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 95%;
    }

    @media (max-width: 768px){
        table{
            font-size: 13px;
        }
        th, td{
            padding: 8px;
        }
    }
    .search-box{
    width:65%;
    margin: 15px auto;
}

.search-box input{
    width:100%;
    padding:8px 12px;
    border-radius:6px;
    border:1px solid #ccc;
    font-size:14px;
}
button:last-child{
    color: #dc2626;
}

button:last-child:hover{
    color: #b91c1c;
}
</style>
</head>
<body>

    <h1>Student Admin Panel</h1>
     <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search by name, email or username...">
        </div>
    <table id="studentTable">
        <thead>
            <tr>
                <th>S.No</th>
                <th>Name</th>
                <th>Email</th>
                <th>City</th>
                <th>Username</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="tableBody">
        </tbody>

    </table>
      <script>
        let currentEditingRow = null;
window.onload = function(){
    loadStudents();
};

function loadStudents(){
    fetch("http://localhost:1000/students")
    .then(res => res.json())
    .then(data => {

        console.log("API DATA:", data); // ðŸ”¥ debug line

        if(!data.students){
            console.log("No students key in response");
            return;
        }

        let students = data.students;
        let tbody = document.getElementById("tableBody");
        tbody.innerHTML = "";

            students.forEach((stu, index) => {
            let row = `
            <tr data-id="${stu.id}">
                <td>${index + 1}</td>
                <td>${stu.name}</td>
                <td>${stu.email}</td>
                <td>${stu.city}</td>
                <td>${stu.username}</td>
            <td>
                <button onclick="editRow(this)">
            <i class="fa-solid fa-pen"></i>
        </button>

        <button onclick="deleteStudent(${stu.id})">
            <i class="fa-solid fa-trash"></i>
        </button>
            </td>
        </tr>
        `;
            tbody.innerHTML += row;
        });
    })
    .catch(err => {
        console.log("Fetch Error:", err);
    });
}
// ===== DELETE =====
function deleteStudent(id){
    if(!confirm("Are you sure you want to delete this student?")){
        return;
    }

    fetch(`http://localhost:1000/student/${id}`, {
        method: "DELETE"
    })
    .then(res => res.json())
    .then(data => {
        alert(data.message);
        loadStudents(); // reload table
    })
    .catch(err => console.log(err));
}
// ===== EDIT =====
function editRow(button){

    let row = button.closest("tr");

    // Agar koi aur row edit me hai, use reset karo
    if(currentEditingRow && currentEditingRow !== row){
        resetRow(currentEditingRow);
    }

    currentEditingRow = row;

    let nameCell = row.children[1];
    let emailCell = row.children[2];
    let cityCell = row.children[3];
    let usernameCell = row.children[4];

    nameCell.innerHTML = `<input type="text" value="${nameCell.innerText}">`;
    emailCell.innerHTML = `<input type="text" value="${emailCell.innerText}">`;
    cityCell.innerHTML = `<input type="text" value="${cityCell.innerText}">`;
    usernameCell.innerHTML = `<input type="text" value="${usernameCell.innerText}">`;

    button.innerHTML = '<i class="fa-solid fa-floppy-disk"></i>';
    button.onclick = function(){
        saveRow(this);
    };
}

// ===== SAVE =====
function saveRow(button){

    let row = button.closest("tr");
    let id = row.getAttribute("data-id");

    let name = row.children[1].querySelector("input").value;
    let email = row.children[2].querySelector("input").value;
    let city = row.children[3].querySelector("input").value;
    let username = row.children[4].querySelector("input").value;

    fetch(`http://localhost:1000/student/${id}`, {
        method: "PUT",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            name,
            email,
            city,
            username
        })
    })
    .then(res => res.json())
    .then(data => {

        row.children[1].innerText = name;
        row.children[2].innerText = email;
        row.children[3].innerText = city;
        row.children[4].innerText = username;

        button.innerHTML = '<i class="fa-solid fa-pen"></i>';
        button.onclick = function(){
            editRow(this);
        };

        currentEditingRow = null;
    })
    .catch(err => console.log(err));
}

// ===== RESET ROW =====
function resetRow(row){

    let name = row.children[1].querySelector("input").value;
    let email = row.children[2].querySelector("input").value;
    let city = row.children[3].querySelector("input").value;
    let username = row.children[4].querySelector("input").value;

    row.children[1].innerText = name;
    row.children[2].innerText = email;
    row.children[3].innerText = city;
    row.children[4].innerText = username;


    let button = row.querySelector("button");
   button.innerHTML = '<i class="fa-solid fa-pen"></i>';
    button.onclick = function(){
        editRow(this);
    };

    currentEditingRow = null;
}
let searchInput = document.getElementById("searchInput");

searchInput.addEventListener("input", function () {
    let value = this.value.toLowerCase();
    let rows = document.querySelectorAll("tbody tr");

    rows.forEach(row => {
        let text = row.innerText.toLowerCase();

        if(text.includes(value)){
            row.style.display = "";
        } else {
            row.style.display = "none";
        }
    });
});
</script>       
</body>
</html>
