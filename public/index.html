<html>
    <head>
        <title>Student Registration Form</title>
<style>

body{
    margin:0;
    padding:0;
    font-family:'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #dbeafe, #e0f2fe, #f0f9ff);
    min-height:100vh;
}

.form-box{
    max-width:500px;
    margin:60px auto;
    padding:45px;
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(20px);
    border-radius:20px;
    border:1px solid rgba(255,255,255,0.4);
    box-shadow:0 20px 40px rgba(0,0,0,0.08);
}

h2{
    text-align:center;
    color:#1e3a8a;
    margin-bottom:25px;
}


input{
    width:100%;
    padding:12px 15px;
    margin:8px 0;
    border-radius:8px;
    border:1px solid #e5e7eb;
    font-size:14px;
    transition:0.3s;
}

input:focus{
    border-color:#2563eb;
    box-shadow:0 0 0 3px rgba(37,99,235,0.1);
    outline:none;
}

small{
    font-size:12px;
    display:block;
    margin-bottom:5px;
}

.btn-row{
    display:flex;
    gap:10px;
    margin-top:15px;
}

.btn-row button{
    flex:1;
    padding:12px;
    border-radius:8px;
    border:none;
    font-size:15px;
    cursor:pointer;
    transition:0.3s;
}

#previewBtn{
    background:#e5e7eb;
}

#previewBtn:hover{
    background:#d1d5db;
}

#submitBtn{
    background:#2563eb;
    color:white;
}

#submitBtn:hover{
    background:#1e40af;
}

#showTableBtn{
    background:white;
    border:1px solid #2563eb;
    color:#2563eb;
    border-radius:8px;
    padding:10px;
    margin-top:10px;
    cursor:pointer;
    transition:0.3s;
}

#showTableBtn:hover{
    background:#2563eb;
    color:white;
}

.next-arrow{
    background:none;
    border:none;
    font-size:22px;
    cursor:pointer;
    margin-top:10px;
    color:#2563eb;
}

.next-arrow:hover{
    transform:translateX(5px);
}

.valid{
    border:1px solid #22c55e;
}

.invalid{
    border:1px solid red;
}

.info-text{
    font-size:12px;
    color:#6b7280;
    margin-top:5px;
}

#previewModal{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.5);
    justify-content:center;
    align-items:center;
}

#previewModal > div{
    background:white;
    padding:25px;
    width:400px;
    border-radius:12px;
    box-shadow:0 10px 25px rgba(0,0,0,0.2);
}

#previewModal button{
    flex:1;
    padding:10px;
    border-radius:8px;
    border:none;
    cursor:pointer;
}

#confirmBtn{
    background:#2563eb;
    color:white;
}

#editBtn{
    background:#e5e7eb;
}

</style>

        </head>
        <body>
            <div class="form-box">
            <h2>Student Registration Form</h2>
            <form id="regForm">
                <input type="text" id="name" placeholder="Full Name"required>
                <small id="nameError" style="color:red;"></small>

                <input type="text" id="isd" placeholder="+91" required>
                <small id="isdError" style="color:red"></small>

                <input type="email" id="email" placeholder="E-mail"required>
                <small id="emailError" style="color:red"></small>

                <input type="text" id="address" placeholder="Address"required>
                <small id="addressError" style="color:red"></small>

                <input type="text" id="pincode" placeholder="Pin Code"required>
                <small id="pinError" style="color:red;"></small>

                <input type="text" id="city" placeholder="City"required>
                <small id="cityError" style="color:red"></small>

                <input type="text" id="state" placeholder="State"required>
                <small id="stateError" style="color:red"></small>

                <input type="text" id="country" placeholder="Country"readonly>
                <small id="countryError" style="color:red;"></small>


                <input type="date" id="dob" required>
                <small id="dobError" style="Color:red"></small>

                <p class="info-text">
                    Please fill this row.
                </p>

                <input type="text" id="Username" placeholder="Username"required>
                <small id="usernameError" style="color:red"></small>

                <input type="password" id="password" placeholder="Password"required>
                <small id="passError" style="color:red;"></small> 

                <input type="password" id="confirmPassword" placeholder="Confirm Password">
                <small id="confirmPassError" style="color:red;"></small>

               <div class="btn-row">
                <button type="button" id="previewBtn">Preview</button>
                <button type="submit" id="submitBtn">Submit</button>
               </div>

               <div style="text-align: center; margin-top: 10px;">
                    <button type="button" id="showTableBtn"
                    style="width: 50%; padding: 8px; border-radius: 20px;">Show Table</button>
                </div>
            </form>

            <!-- ===== PREVIEW MODAL ===== -->
            <div id="previewModal" style="
                display:none;
                position:fixed;
                top:0; left:0;
                width:100%;
                height:100%;
                background:rgba(0,0,0,0.6);
                justify-content:center;
                align-items:center;
            ">

            <div style="
                background:white;
                padding:25px;
                width:400px;
                border-radius:15px;
              ">

            <h3>Preview Student Details</h3>
            <div id="previewContent"></div>

        <div style="display:flex; gap:10px; margin-top:15px;">
        <button id="confirmBtn">Confirm</button>
        <button id="editBtn">Edit</button>
    </div>

  </div>
</div>
    </div>
            <script>

                document.getElementById("name").addEventListener("input",function(){
                    let value = this.value;
                    let error = document.getElementById("nameError");

                    if(/^[A-Za-z ]+$/.test(value) && value.length >= 4){
                        this.classList.add("valid");
                        this.classList.remove("invalid");
                        error.innerText= "";
                    }else{
                        this.classList.add("invalid");
                        this.classList.remove("valid");
                        error.innerText = "Only alphabets allowed & minimum 4 letters required";
                    }
                });

                document.getElementById("email").addEventListener("input",function(){
                    let value = this.value;
                    let error = document.getElementById("emailError");

                    let emailPattern = /^[a-z0-9._%+-]+@gmail\.com$/;

                    if(emailPattern.test(value)){
                        this.classList.add("valid");
                        this.classList.remove("invalid");
                        error.innerText= "";
                    }else{
                        this.classList.add("invalid");
                        this.classList.remove("valid");
                        error.innerText="Enter valid E-mail Address";
                    }
                    });

                    document.getElementById("address").addEventListener("input",function(){
                        let value = this.value;
                        let error = document.getElementById("addressError");

                        let addressPattern = /^[A-Za-z0-9 ,]+$/;

                        if(addressPattern.test(value)){
                            this.classList.add("valid");
                            this.classList.remove("invalid");
                            error.innerText= "";
                        }else{
                            this.classList.add("invalid");
                            this.classList.remove("valid");
                            error.innerText="Address can contain letters, numbers and spaces";
                        }
                    });

                const isdCountryMap = {
                "+91": "India",
                "+92": "Pakistan",
                "+1": "United States",
                "+44": "United Kingdom",
                "+61": "Australia",
                "+81": "Japan",
                "+86": "China",
                "+7": "Russia",
                "+49": "Germany",
                "+33": "France",
                "+971": "UAE",
                "+880": "Bangladesh",
                "+94": "Sri Lanka",
                "+39": "Italy",
                "+34": "Spain"
                }

                document.getElementById("isd").addEventListener("input", function () {
                    let value = this.value.replace(/[^+0-9]/g, "");
                    this.value = value;

                    let error = document.getElementById("isdError");
                    let country = document.getElementById("country");

                    this.classList.remove("valid", "invalid");
                    country.value = "";
                    error.innerText = "";

                    let matchedISD = null;

                    for (let code in isdCountryMap) {
                        if (value.startsWith(code)) {
                        matchedISD = code;
                        break;
                    }
                }

                    if (!matchedISD) {
                        this.classList.add("invalid");
                        error.innerText = "Invalid ISD code";
                    return;
                    }

                    country.value = isdCountryMap[matchedISD];
                    country.classList.add("valid");

                    let numberPart = value.slice(matchedISD.length);

                    if (numberPart.length < 10) {
                        this.classList.add("invalid")
                        error.innerText = "Enter 10 digit number after ISD";
                    }
                    else if (numberPart.length > 10) {
                        this.classList.add("invalid")
                        error.innerText = "Only 10 digits allowed after ISD";
                    }
                    else {
                        this.classList.add("valid");
                        error.innerText = "";
                    }
                });
                
                document.getElementById("pincode").addEventListener("input", function () {
                let pin = this.value.replace(/[^0-9]/g, "");
                let pinError = document.getElementById("pinError");

                pin = pin.slice(0, 6);
                this.value = pin;

                this.classList.remove("valid", "invalid");

                 if (pin.length < 6) {
                pinError.innerText = "Enter 6 digit pincode";
                this.classList.add("invalid");
                    clearLocation();
                     return;
                }
                
                fetch("https://api.postalpincode.in/pincode/" + pin)
                    .then(res => res.json())
                    .then(data => {
                    if (data[0].Status === "Success") {
                   let postOffices = data[0].PostOffice;
                   let po = postOffices[postOffices.length - 1];
                    document.getElementById("city").value = po.District;
                    document.getElementById("state").value = po.State;
                    document.getElementById("country").value =po.Country;

                    document.getElementById("city").dispatchEvent(new Event("input"));
                    document.getElementById("state").dispatchEvent(new Event("input"));


                    pinError.innerText = "";
                    this.classList.add("valid");

                } else {
                    pinError.innerText = "Invalid Pincode";
                    this.classList.add("invalid");
                    clearLocation();
                    }
                 })
                    .catch(() => {
                 pinError.innerText = "Server Error";
                 this.classList.add("invalid");
                clearLocation();
                 });

                function clearLocation() {
                document.getElementById("city").value = "";
                document.getElementById("state").value = "";
                 }
                });

                document.getElementById("city").addEventListener("input", function(){
                    let value = this.value;
                    let error = document.getElementById("cityError");

                    let cityPattern = /^[A-Za-z ]+$/;

                    if(cityPattern.test(this.value)){
                        this.classList.add("valid");
                        this.classList.remove("invalid");
                        error.innerText = "";
                    }else{
                        this.classList.add("invalid");
                        this.classList.remove("valid");
                        error.innerText = "Only alphabets allowed"
                    }
                });

                document.getElementById("state").addEventListener("input", function(){
                    let value = this.value;
                    let error = document.getElementById("stateError");

                    let statePattern = /^[A-Za-z ]+$/;

                    if(statePattern.test(this.value)){
                        this.classList.add("valid");
                        this.classList.remove("invalid");
                        error.innerText="";
                    }else{
                        this.classList.add("invalid");
                        this.classList.remove("valid");
                        error.innerText="Only alphabets allowed"
                    }
                });

                document.getElementById("dob").addEventListener("input", function(){
                    let value = this.value;
                    let error = document.getElementById("dobError");

                    let dobPattern = /^\d{4}-\d{2}-\d{2}$/;

                    if(dobPattern.test(this.value)){
                        this.classList.add("valid");
                        this.classList.remove("invalid");
                        error.innerText = "";
                    }else {
                        this.classList.add("invalid");
                        this.classList.remove("valid");
                        error.innerText="Invalid Date of Birth"
                    }
                });

                document.getElementById("Username").addEventListener("input", function(){
                    let value = this.value;
                    let error = document.getElementById("usernameError");

                    let usernamePattern = /^[A-Za-z0-9]+$/;

                    if(usernamePattern.test(this.value)){
                        this.classList.add("valid");
                        this.classList.remove("invalid");
                        error.innerText = "";
                    }else {
                        this.classList.add("invalid");
                        this.classList.remove("valid");
                        error.innerText = "Only letters and numbers allowed"
                    }

                });
                
                document.getElementById("password").addEventListener("input", function () {
                let value = this.value;
                let cpass = this.value;
                let error = document.getElementById("passError");

                let passwordPattern = /^[A-Za-z0-9./;!@#$%]{6,}$/;

                if(passwordPattern.test(value)){
                    this.classList.add("valid");
                    this.classList.remove("invalid");
                    error.innerText="";
                }else{
                    this.classList.add("invalid");
                    this.classList.remove("valid");
                    error.innerText="Minimum 6 characters(letters, numbers, special)";
                }
            });

                document.getElementById("confirmPassword").addEventListener("input", function () {
                let pass = document.getElementById("password").value;
                let cpass = this.value;
                let error = document.getElementById("confirmPassError");

                if(cpass === ""){
                    this.classList.remove("valid", "invalid");
                    error.innerText = "";
                    return;
                }

                if (pass === cpass) {
                    this.classList.add("valid");
                    this.classList.remove("invalid");
                    error.innerText = "";
                } else {
                    this.classList.add("invalid");
                    this.classList.remove("valid")
                    error.innerText = "Password doesn't match";
                }
                });

                document.querySelector("form").addEventListener("submit",function(e){
                e.preventDefault();

                let studentData = {
                name: document.getElementById("name").value,
                isd: document.getElementById("isd").value,
                email: document.getElementById("email").value,
                address: document.getElementById("address").value,
                pincode: document.getElementById("pincode").value,
                city: document.getElementById("city").value,
                state: document.getElementById("state").value,
                country: document.getElementById("country").value,
                dob: document.getElementById("dob").value,
                username: document.getElementById("Username").value,
                password: document.getElementById("password").value,
                confirmPassword: document.getElementById("confirmPassword").value
            };

                fetch("http://localhost:1000/register", {
                method: "POST",
                headers: {
                "Content-Type": "application/json"
            },
                 body: JSON.stringify(studentData)
            })
                .then(res => res.json())
                .then(data => {
                console.log("Server reply:", data);

                if(data.success === false){
                    alert("❌ " + data.message);
                } else {
                    alert("✅ " + data.message);
                }
            })
                 .catch(err => console.log("Error:", err));

                });

                // ===== PREVIEW SYSTEM =====

                let nameInput = document.getElementById("name");
                let isdInput = document.getElementById("isd");
                let emailInput = document.getElementById("email");
                let addressInput = document.getElementById("address");
                let pincodeInput = document.getElementById("pincode");
                let cityInput = document.getElementById("city");
                let stateInput = document.getElementById("state");
                let countryInput = document.getElementById("country");
                let dobInput = document.getElementById("dob");
                let usernameInput = document.getElementById("Username");

                let previewBtn = document.getElementById("previewBtn");
                let previewModal = document.getElementById("previewModal");
                let previewContent = document.getElementById("previewContent");
                let confirmBtn = document.getElementById("confirmBtn");
                let editBtn = document.getElementById("editBtn");
                let submitBtn = document.getElementById("submitBtn");

            previewBtn.addEventListener("click", function(){

                let data = {
                    name: nameInput.value,
                    isd: isdInput.value,
                    email: emailInput.value,
                    address: addressInput.value,
                    pincode: pincodeInput.value,
                    city: cityInput.value,
                    state: stateInput.value,
                    country: countryInput.value,
                    dob: dobInput.value,
                    username: usernameInput.value
            };

                let html = `
                <p><b>Name:</b> ${data.name}</p>
                <p><b>ISD:</b> ${data.isd}</p>
                <p><b>Email:</b> ${data.email}</p>
                <p><b>Address:</b> ${data.address}</p>
                <p><b>Pincode:</b> ${data.pincode}</p>
                <p><b>City:</b> ${data.city}</p>
                <p><b>State:</b> ${data.state}</p>
                <p><b>Country:</b> ${data.country}</p>
                <p><b>DOB:</b> ${data.dob}</p>
                <p><b>Username:</b> ${data.username}</p>
            `;

                previewContent.innerHTML = html;
                previewModal.style.display = "flex";
            });

                editBtn.addEventListener("click", function(){
                previewModal.style.display = "none";
            });

                confirmBtn.addEventListener("click", function(){
                previewModal.style.display = "none";
                submitBtn.click();
            });

            const inputs = Array.from(document.querySelectorAll("#regForm input"));

            inputs.forEach((input, index) => {
                input.addEventListener("keydown", function(e){
                    if(e.key === "Enter"){
                    e.preventDefault();

// next input focus
                if(inputs[index + 1]){
                    inputs[index + 1].focus();
                }
            }
        });
    });
    let showTableBtn = document.getElementById("showTableBtn");

    showTableBtn.addEventListener("click", function(){
        window.location.href = "admin.html";
    });
        </script>
 </body>
 </html>